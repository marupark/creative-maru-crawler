name: MAILNARA v7.0 - API 기반 지원사업 수집

on:
  schedule:
    # 매일 오전 9시 (한국시간 기준) 실행
    - cron: '0 0 * * *'  # UTC 기준이므로 한국시간 9시는 UTC 0시
  workflow_dispatch:  # 수동 실행 가능
    inputs:
      test_mode:
        description: '테스트 모드로 실행'
        required: false
        default: 'false'

jobs:
  collect-and-send:
    runs-on: ubuntu-latest
    
    steps:
    - name: 📦 코드 체크아웃
      uses: actions/checkout@v4
    
    - name: 🔧 Node.js 설정
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: 📋 의존성 설치
      run: npm install
    
    - name: 🕒 실행 시간 확인
      run: |
        echo "🌏 현재 시간 (UTC): $(date)"
        echo "🇰🇷 한국 시간: $(TZ='Asia/Seoul' date)"
    
    - name: 🚀 MAILNARA v7.0 실행
      env:
        # API 키
        BIZINFO_API_KEY: ${{ secrets.BIZINFO_API_KEY }}
        
        # 이메일 설정 (v6.0과 동일)
        EMAIL_USER: ${{ secrets.EMAIL_USER }}
        EMAIL_PASS: ${{ secrets.EMAIL_PASS }}
        
        # 테스트 모드
        TEST_MODE: ${{ github.event.inputs.test_mode || 'false' }}
      run: |
        echo "🎯 MAILNARA v7.0 시작 - 3개 기관 타겟"
        echo "📋 타겟 기관: KIDP, RIPC, KOTRA"
        echo "🔑 API 키: ${BIZINFO_API_KEY:0:10}***"
        echo "📧 이메일: ${EMAIL_USER}"
        echo "🧪 테스트 모드: $TEST_MODE"
        echo ""
        
        node index.js
    
    - name: 📊 실행 결과 요약
      if: always()
      run: |
        echo "✅ MAILNARA v7.0 실행 완료"
        echo "🔗 상세 로그는 위 단계에서 확인하세요"
        echo ""
        echo "📈 v7.0 개선사항:"
        echo "   • 크롤링 → API 방식 전환"
        echo "   • 3개 기관 집중 타겟팅"
        echo "   • 크리에이티브마루 맞춤 필터링"
        echo "   • 100% 안정적 운영"

# 보안 참고사항
# GitHub Secrets에 다음 값들이 설정되어 있어야 합니다:
# - BIZINFO_API_KEY: 기업마당에서 발급받은 API 키
# - EMAIL_USER: Gmail 계정
# - EMAIL_PASS: Gmail 앱 비밀번호
