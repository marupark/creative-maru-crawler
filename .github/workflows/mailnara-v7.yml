name: MAILNARA v7.0 - API ê¸°ë°˜ ì§€ì›ì‚¬ì—… ìˆ˜ì§‘

on:
  schedule:
    # ë§¤ì¼ ì˜¤ì „ 9ì‹œ (í•œêµ­ì‹œê°„ ê¸°ì¤€) ì‹¤í–‰
    - cron: '0 0 * * *'  # UTC ê¸°ì¤€ì´ë¯€ë¡œ í•œêµ­ì‹œê°„ 9ì‹œëŠ” UTC 0ì‹œ
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥
    inputs:
      test_mode:
        description: 'í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ ì‹¤í–‰'
        required: false
        default: 'false'

jobs:
  collect-and-send:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¦ ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
    
    - name: ğŸ”§ Node.js ì„¤ì •
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: ğŸ“‹ ì˜ì¡´ì„± ì„¤ì¹˜
      run: npm install
    
    - name: ğŸ•’ ì‹¤í–‰ ì‹œê°„ í™•ì¸
      run: |
        echo "ğŸŒ í˜„ì¬ ì‹œê°„ (UTC): $(date)"
        echo "ğŸ‡°ğŸ‡· í•œêµ­ ì‹œê°„: $(TZ='Asia/Seoul' date)"
    
    - name: ğŸš€ MAILNARA v7.0 ì‹¤í–‰
      env:
        # API í‚¤
        BIZINFO_API_KEY: ${{ secrets.BIZINFO_API_KEY }}
        
        # ì´ë©”ì¼ ì„¤ì • (ê¸°ì¡´ v6.0 secrets í™œìš©)
        EMAIL_USER: ${{ secrets.GMAIL_USER }}
        EMAIL_PASS: ${{ secrets.GMAIL_PASSWORD }}
        
        # í…ŒìŠ¤íŠ¸ ëª¨ë“œ
        TEST_MODE: ${{ github.event.inputs.test_mode || 'false' }}
      run: |
        echo "ğŸ¯ MAILNARA v7.0 ì‹œì‘ - 3ê°œ ê¸°ê´€ íƒ€ê²Ÿ"
        echo "ğŸ“‹ íƒ€ê²Ÿ ê¸°ê´€: KIDP, RIPC, KOTRA"
        echo "ğŸ”‘ API í‚¤: ${BIZINFO_API_KEY:0:10}***"
        echo "ğŸ“§ ì´ë©”ì¼: ${EMAIL_USER}"
        echo "ğŸ§ª í…ŒìŠ¤íŠ¸ ëª¨ë“œ: $TEST_MODE"
        echo ""
        
        node index.js
    
    - name: ğŸ“Š ì‹¤í–‰ ê²°ê³¼ ìš”ì•½
      if: always()
      run: |
        echo "âœ… MAILNARA v7.0 ì‹¤í–‰ ì™„ë£Œ"
        echo "ğŸ”— ìƒì„¸ ë¡œê·¸ëŠ” ìœ„ ë‹¨ê³„ì—ì„œ í™•ì¸í•˜ì„¸ìš”"
        echo ""
        echo "ğŸ“ˆ v7.0 ê°œì„ ì‚¬í•­:"
        echo "   â€¢ í¬ë¡¤ë§ â†’ API ë°©ì‹ ì „í™˜"
        echo "   â€¢ 3ê°œ ê¸°ê´€ ì§‘ì¤‘ íƒ€ê²ŸíŒ…"
        echo "   â€¢ í¬ë¦¬ì—ì´í‹°ë¸Œë§ˆë£¨ ë§ì¶¤ í•„í„°ë§"
        echo "   â€¢ 100% ì•ˆì •ì  ìš´ì˜"

# ë³´ì•ˆ ì°¸ê³ ì‚¬í•­
# GitHub Secretsì— ë‹¤ìŒ ê°’ë“¤ì´ ì„¤ì •ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤:
# - BIZINFO_API_KEY: ê¸°ì—…ë§ˆë‹¹ì—ì„œ ë°œê¸‰ë°›ì€ API í‚¤
# - EMAIL_USER: Gmail ê³„ì •
# - EMAIL_PASS: Gmail ì•± ë¹„ë°€ë²ˆí˜¸
